version: "3.9"
services:
  cris:
    image: cris:latest
    ports: # Comment this section when deployed on a production server
      - "8000:8000" # If you want to see the CRIS via the port
      - "3030:3030"
    environment:
      username: "admin"
      password: "pw"
      client_id: ""
      client_secret: ""
      redirect_uri: "https://localhost/orcid/"
    volumes:
      - db:/var/lib/mysql
      - fuseki:/app/fuseki
    deploy:
      placement:
        constraints:
          - node.role==manager
    labels:
          - "traefik.enable=true"
          - "traefik.http.routers.cris.rule=Host(`localhost`)" # Change url here
          - "traefik.docker.network=reverse_network"
          - "traefik.http.routers.cris.entrypoints=websecure"
          - "traefik.http.routers.cris.tls=true"
          - "traefik.http.routers.cris.tls.certresolver=myresolver"
          - "traefik.http.services.cris.loadbalancer.server.port=8000"
volumes:
  db:
  fuseki:
